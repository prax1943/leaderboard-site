<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PK4 üêå</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    html, body {
      min-height: 100%;
      height: 100%;
      width: 100%;
    }
    body {
      margin: 0;
      padding: 3rem;
      font-family: 'Montserrat', sans-serif;
      background: radial-gradient(ellipse at center, #330000 0%, #110000 70%);
      color: #eee;
      min-height: 100vh;
      user-select: none;
      perspective: 1000px;
      overflow-x: hidden;
      overflow-y: auto;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .snail-drop-container { pointer-events: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 1000; overflow: hidden;}
    .wrapper { max-width: 720px; width: 90vw; position: relative; z-index: 1;}
    .menu { display: flex; justify-content: center; margin-bottom: 2rem; gap: 2rem; user-select: none;}
    .tab { padding: 12px 30px; border-radius: 30px; cursor: pointer; font-weight: 700; font-size: 1.1rem; color: #ff4b4b; background: #220000; box-shadow: 0 0 8px #ff4b4b88; transition: all 0.3s ease; border: 2px solid transparent; user-select: none; user-drag: none;}
    .tab:hover, .tab.active { background: #ff4b4b; color: #111; box-shadow: 0 0 20px #ff4b4bcc; border-color: #ff4b4b;}
    .container { background: linear-gradient(145deg, #2b0000, #480000); padding: 2rem 3rem; border-radius: 20px; box-shadow: 0 0 20px #ff1e1e88, inset 0 0 40px #ff4b4baa; transform-style: preserve-3d; transition: box-shadow 0.3s ease; user-select: none;}
    .content { display: none; color: #ffc9c9;}
    .content.active { display: block;}
    h1 { font-weight: 700; font-size: 3rem; letter-spacing: 3px; color: #ff4b4b; margin-bottom: 2rem; text-shadow: 0 0 12px #ff4b4bcc; user-select: none; text-align: center;}
    input[type="text"], input[type="number"], input[type="password"] { width: 100%; padding: 14px 20px; font-size: 1.2rem; border: 2px solid #ff4b4b; border-radius: 30px; background: transparent; color: #eee; outline: none; transition: all 0.3s ease; margin-bottom: 2rem; text-align: center; user-select: text;}
    input[type="text"]::placeholder, input[type="number"]::placeholder, input[type="password"]::placeholder { color: #d1a3a3;}
    input[type="text"]:focus, input[type="number"]:focus, input[type="password"]:focus { background-color: #ff4b4b; color: #111; box-shadow: 0 0 20px #ff4b4bcc; border-color: #ff4b4b;}
    .rank-info { font-size: 1.3rem; margin-bottom: 3rem; font-weight: 600; text-align: center; min-height: 2.4rem; color: #ffc9c9; letter-spacing: 0.1em; user-select: none;}
    .scrollable-table-wrapper { max-height: 340px; overflow-y: auto; overflow-x: hidden; margin-bottom: 1.5em; background: none; scrollbar-gutter: stable;}
    .scrollable-queue-wrapper { max-height: 360px; overflow-y: auto; overflow-x: hidden; background: none; scrollbar-gutter: stable;}
    .scrollable-table-wrapper::-webkit-scrollbar, .scrollable-queue-wrapper::-webkit-scrollbar { width: 8px; background: transparent;}
    .scrollable-table-wrapper::-webkit-scrollbar-thumb, .scrollable-queue-wrapper::-webkit-scrollbar-thumb { background: linear-gradient(145deg, #ff4b4b66, #ff4b4b22); border-radius: 20px;}
    .scrollable-table-wrapper, .scrollable-queue-wrapper { scrollbar-width: thin; scrollbar-color: #ff4b4b44 transparent;}
    table { width: 100%; border-collapse: collapse; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 20px rgba(255, 75, 75, 0.7); background: #3c0000;}
    th, td { padding: 18px 24px; text-align: left; border-bottom: 1px solid #772222; font-weight: 500; font-size: 1.1rem; color: #ffc9c9;}
    th { background-color: #550000; color: #ffb3b3; letter-spacing: 0.15em; font-weight: 700;}
    tbody tr:hover { background-color: #ff4b4bcc; color: #111; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease;}
    .rank-tier { display: inline-block; padding: 6px 18px; border-radius: 40px; font-weight: 700; font-size: 1rem; background-color: #ff4b4b; color: #fff; letter-spacing: 0.15em; box-shadow: 0 0 10px #ff4b4bcc; user-select: none;}
    .S { background-color: #ff6666; box-shadow: 0 0 15px #ff6666cc;}
    .A { background-color: #ff4b4b;}
    .B { background-color: #cc3a3a;}
    .C { background-color: #992828;}
    .D { background-color: #661818;}
    .contact-list { font-size: 1.2rem; line-height: 2; max-width: 480px; margin: 0 auto; text-align: center; color: #ffc9c9;}
    .contact-list a { color: #ff4b4b; text-decoration: none; font-weight: 700; transition: color 0.3s ease;}
    .contact-list a:hover { color: #ff9999; text-decoration: underline;}
    .queue-form { max-width: 400px; margin: 0 auto 2rem auto; background: #2b000088; padding: 1.5rem 2rem 2rem 2rem; border-radius: 20px; box-shadow: 0 0 20px #ff4b4b22, 0 0 0 #000; display: flex; flex-direction: column; align-items: center; gap: 12px;}
    .queue-form label { font-weight: 600; color: #ffb3b3; font-size: 1.1rem; margin-bottom: 0.2rem; align-self: flex-start;}
    .queue-form button { margin-top: 1rem; background: #ff4b4b; color: #fff; font-weight: 700; padding: 12px 32px; border: none; border-radius: 30px; font-size: 1.1rem; box-shadow: 0 0 10px #ff4b4baa; cursor: pointer; transition: 0.2s;}
    .queue-form button:hover { background: #ff9999; color: #111;}
    .queue-message { margin-bottom: 1rem; text-align: center; color: #ffb3b3; font-size: 1.1rem; min-height: 1.4em;}
    .queue-list { max-width: 400px; margin: 0 auto; background: #440000cc; border-radius: 16px; padding: 1.5rem; box-shadow: 0 0 20px #ff4b4b22; color: #ffc9c9; font-size: 1.1rem; overflow: hidden;}
    .queue-list-title { font-weight: 700; margin-bottom: 0.5em; color: #ff4b4b; text-align: center; letter-spacing: 0.1em;}
    .queue-list ol { padding-left: 1.3em; margin: 0;}
    .queue-list li { padding: 0.3em 0; border-bottom: 1px solid #66181833; word-break: break-word; display: flex; align-items: center; justify-content: space-between;}
    .queue-list .admin-queue-btns button { margin-left: 0.6em; background: #ff4b4b; color: #fff; border: none; border-radius: 18px; padding: 2px 10px; font-size: 0.95em; cursor: pointer; transition: background 0.15s;}
    .queue-list .admin-queue-btns button:hover { background: #ff9999; color: #111;}
    .queue-waiting { max-width: 400px; margin: 0 auto; background: #220000dd; border-radius: 22px; padding: 2.5rem 2rem 2rem 2rem; box-shadow: 0 0 30px #ff4b4b44; color: #ffc9c9; font-size: 1.2rem; text-align: center; animation: fadeIn 0.7s; display: none;}
    .queue-waiting h2 { color: #ff4b4b; margin-bottom: 1rem; font-size: 2.1rem; letter-spacing: 2px; text-shadow: 0 0 8px #ff4b4bcc;}
    .queue-waiting .your-queue { margin: 1.5rem 0 0.7rem 0; font-weight: bold; font-size: 1.2em; color: #fff;}
    .queue-waiting .others { color: #ffb3b3; margin-top: 1.3em; font-size: .95em; opacity: .85;}
    .queue-waiting .leave-btn { margin-top: 2em; background: #772222; color: #fff; font-weight: 700; padding: 10px 28px; border: none; border-radius: 30px; font-size: 1em; box-shadow: 0 0 7px #ff4b4baa; cursor: pointer; transition: 0.2s;}
    .queue-waiting .leave-btn:hover { background: #ff4b4b; color: #111;}
    .admin-login-form, .admin-panel { max-width: 400px; margin: 0 auto 2rem auto; background: #2b000088; padding: 2rem 2rem 2rem 2rem; border-radius: 20px; box-shadow: 0 0 20px #ff4b4b22, 0 0 0 #000; display: flex; flex-direction: column; align-items: center; gap: 16px;}
    .admin-login-form label { font-weight: 600; color: #ffb3b3; font-size: 1.1rem; margin-bottom: 0.2rem; align-self: flex-start;}
    .admin-login-form button, .admin-panel button { margin-top: 1rem; background: #ff4b4b; color: #fff; font-weight: 700; padding: 12px 32px; border: none; border-radius: 30px; font-size: 1.1rem; box-shadow: 0 0 10px #ff4b4baa; cursor: pointer; transition: 0.2s;}
    .admin-login-form button:hover, .admin-panel button:hover { background: #ff9999; color: #111;}
    .admin-message { color: #ffb3b3; min-height: 1.5em; text-align: center; font-size: 1.1em;}
    .admin-panel { gap: 18px;}
    .admin-panel label { align-self: flex-start; color: #ffb3b3; font-weight: 600; margin-bottom: 0.2rem;}
    .admin-panel input[type="text"], .admin-panel input[type="number"] { margin-bottom: 0.5rem;}
    .admin-panel .players-list { width: 100%; margin-top: 1.2em; font-size: 1em; max-height: 260px; overflow-y: auto; background: none; scrollbar-gutter: stable;}
    .admin-panel .players-list::-webkit-scrollbar { width: 8px; background: transparent;}
    .admin-panel .players-list::-webkit-scrollbar-thumb { background: linear-gradient(145deg, #ff4b4b66, #ff4b4b22); border-radius: 20px;}
    .admin-panel .players-list { scrollbar-width: thin; scrollbar-color: #ff4b4b44 transparent;}
    .admin-panel .players-list table { width: 100%; background: #4f0000; border-radius: 12px; overflow: hidden; margin-bottom: 1em; box-shadow: 0 0 10px #ff4b4b44;}
    .admin-panel .players-list th, .admin-panel .players-list td { padding: 10px 8px; font-size: 0.98em; color: #ffc9c9; text-align: center;}
    .admin-panel .players-list th { background: #660000; color: #ffb3b3;}
    .admin-panel .players-list button { background: #ff4b4b; color: #fff; border: none; border-radius: 16px; padding: 2px 10px; font-size: 0.95em; cursor: pointer; margin: 0 2px; transition: background 0.15s;}
    .admin-panel .players-list button:hover { background: #ff9999; color: #111;}
    .copyable-name { cursor: pointer; color: #ffb3b3; text-decoration: none; transition: background 0.2s, color 0.2s;}
    .copyable-name:hover { background: #ff4b4b33; color: #fff;}
    .admin-toggle-queue { margin: 1em auto 0.5em auto; color: #ffb3b3; font-weight: bold; font-size: 1.1em; text-align: center; display: flex; align-items: center; gap: 0.5em; justify-content: center;}
    .admin-toggle-queue input[type="checkbox"] { transform: scale(1.3); accent-color: #ff4b4b; margin-right: 0.5em;}
    .queue-closed-message { color: #ff4b4b; font-weight: 700; text-align: center; margin-bottom: 2em; font-size: 1.2em; background: #220000cc; border-radius: 15px; padding: 1.2em 0.6em; box-shadow: 0 0 12px #ff4b4baa; display: none;}
    /* SHOP styles */
    .shop-content { display: none; color: #ffc9c9; }
    .shop-content.active { display: block; }
    .shop-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 2.2rem 1.6rem;
      justify-content: center;
      margin-bottom: 2.5em;
    }
    .shop-card {
      background: linear-gradient(140deg, #2b0000 85%, #ff4b4b22 100%);
      border-radius: 20px;
      box-shadow: 0 0 15px #ff4b4b44, 0 0 0 #000;
      color: #ffc9c9;
      padding: 1.4rem 1.1rem 1rem 1.1rem;
      width: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .shop-card:hover {
      box-shadow: 0 0 32px #ff4b4baa;
    }
    .shop-img {
      width: 110px;
      height: 110px;
      object-fit: contain;
      background: #220000cc;
      border-radius: 14px;
      margin-bottom: 1.1em;
      box-shadow: 0 0 8px #ff4b4b33;
      border: 2px solid #ff4b4b44;
    }
    .shop-title {
      font-weight: 700;
      color: #ff4b4b;
      font-size: 1.2em;
      margin-bottom: 0.5em;
      text-align: center;
      text-shadow: 0 0 8px #ff4b4bcc;
    }
    .shop-price {
      font-size: 1.08em;
      font-weight: 600;
      color: #ffb3b3;
      margin-bottom: 0.6em;
    }
    .shop-stock {
      color: #ffc9c9;
      font-size: 1em;
      margin-bottom: 0.7em;
    }
    .shop-admin-actions {
      display: flex;
      gap: 0.6em;
      margin-top: 0.7em;
    }
    .shop-admin-actions button {
      background: #ff4b4b;
      color: #fff;
      border: none;
      border-radius: 18px;
      padding: 5px 13px;
      font-size: 0.97em;
      cursor: pointer;
      transition: background 0.15s;
    }
    .shop-admin-actions button:hover {
      background: #ff9999;
      color: #111;
    }
    .shop-add-form {
      background: #2b000088;
      padding: 1.4rem 2rem 1.3rem 2rem;
      border-radius: 20px;
      box-shadow: 0 0 12px #ff4b4b33;
      margin: 0 auto 2em auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1em;
      max-width: 400px;
    }
    .shop-add-form input[type="text"], 
    .shop-add-form input[type="number"] {
      width: 100%;
      padding: 9px 16px;
      font-size: 1.08em;
      border: 2px solid #ff4b4b;
      border-radius: 30px;
      background: transparent;
      color: #eee;
      outline: none;
      transition: all 0.3s ease;
      margin-bottom: 0.3rem;
      text-align: center;
      user-select: text;
    }
    .shop-add-form button {
      background: #ff4b4b;
      color: #fff;
      font-weight: 700;
      padding: 10px 30px;
      border: none;
      border-radius: 30px;
      font-size: 1.03em;
      box-shadow: 0 0 7px #ff4b4baa;
      cursor: pointer;
      transition: 0.18s;
      margin-top: 0.7em;
    }
    .shop-add-form button:hover {
      background: #ff9999;
      color: #111;
    }
    .shop-form-label {
      align-self: flex-start;
      font-weight: 600;
      color: #ffb3b3;
      font-size: 1.02em;
      margin: 0.2em 0 0.1em 0.2em;
    }
    @keyframes fadeIn { from { opacity: 0; transform: scale(.98);} to   { opacity: 1; transform: scale(1);}}
    /* Popup styles */
    .popup-overlay {
      position: fixed; left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(17,0,0,0.65);
      display: flex; justify-content: center; align-items: center;
      z-index: 20000;
    }
    .popup-box {
      background: linear-gradient(140deg, #2b0000 80%, #ff4b4b22 100%);
      border-radius: 22px;
      box-shadow: 0 0 30px #ff4b4baa;
      color: #ffc9c9;
      padding: 2rem 2.5rem 1.6rem 2.5rem;
      max-width: 380px; min-width: 200px;
      font-size: 1.15em;
      text-align: center;
      animation: fadeIn 0.3s;
    }
    .popup-box h2 {
      color: #ff4b4b;
      margin-bottom: 1rem;
      font-size: 1.45em;
      letter-spacing: 1px;
    }
    .popup-box .popup-msg {
      margin-bottom: 1.4em;
      color: #ffc9c9;
    }
    .popup-box .popup-btns {
      display: flex; justify-content: center; gap: 1.3em;
    }
    .popup-box button {
      background: #ff4b4b;
      color: #fff;
      font-weight: 700;
      padding: 10px 30px;
      border: none;
      border-radius: 25px;
      font-size: 1.06em;
      box-shadow: 0 0 7px #ff4b4baa;
      cursor: pointer;
      transition: 0.18s;
    }
    .popup-box button:hover {
      background: #ff9999;
      color: #111;
    }
    @media (max-width: 600px) {
      h1 { font-size: 2.2rem; }
      th, td { font-size: 0.9rem; padding: 14px 16px; }
      input[type="text"], input[type="number"], input[type="password"] { font-size: 1rem; padding: 12px 16px; }
      .tab { padding: 10px 20px; font-size: 1rem; }
      .contact-list { font-size: 1rem; line-height: 1.6; }
      .queue-form, .queue-list, .queue-waiting, .admin-panel, .admin-login-form { padding: 1rem; }
      .scrollable-table-wrapper, .scrollable-queue-wrapper { max-height: 200px; }
      .admin-panel .players-list { max-height: 160px; }
      .popup-box { padding: 1.2rem 0.7rem 1.1rem 0.7rem; font-size: 1em;}
      .shop-grid { gap: 1.4rem 0.7rem; }
      .shop-card { width: 98vw; padding: 1.1rem 0.3rem 0.7rem 0.3rem;}
      .shop-add-form { padding: 0.8rem 0.3rem 1rem 0.3rem; }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <div class="snail-drop-container" id="snailDropContainer"></div>
  <div id="popupContainer"></div>
  <div class="wrapper">
    <nav class="menu">
      <div class="tab" data-tab="leaderboard">Leaderboard</div>
      <div class="tab active" data-tab="queue">queue</div>
      <div class="tab" data-tab="shop">Shop</div>
      <div class="tab" data-tab="contact">Contact</div>
      <div class="tab" data-tab="admin">Admin</div>
    </nav>
    <div class="container" id="tiltContainer">
      <div id="leaderboard" class="content">
        <h1>Lingkinpug Leaderboard</h1>
        <input type="text" id="searchInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ï‡∏°‡∏Ñ‡∏ô‡πÄ‡∏ó‡πà" autocomplete="off" />
        <div class="rank-info" id="rankInfo">‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
        <div class="scrollable-table-wrapper">
          <table>
            <thead>
              <tr>
                <th>no</th>
                <th>name</th>
                <th>score</th>
                <th>rank</th>
              </tr>
            </thead>
            <tbody id="leaderboardBody"></tbody>
          </table>
        </div>
      </div>
      <div id="queue" class="content active">
        <h1>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h1>
        <div class="queue-closed-message" id="queueClosedMsg">‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</div>
        <form class="queue-form" id="queueForm" autocomplete="off">
          <div class="queue-message" id="queueMessage"></div>
          <label for="queueName">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
          <input type="text" id="queueName" maxlength="24" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°" required />
          <label for="queueNote">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input type="text" id="queueNote" maxlength="40" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏™‡πÅ‡∏Ñ‡∏•‡∏ô/‡∏ã‡∏∑‡πâ‡∏≠‡∏ú‡∏• ‡∏Ø‡∏•‡∏Ø" />
          <button type="submit">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
        </form>
        <div class="queue-list" id="queueList">
          <div class="queue-list-title">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß</div>
          <div class="scrollable-queue-wrapper">
            <ol id="queueListItems"></ol>
          </div>
        </div>
        <div class="queue-waiting" id="queueWaiting">
          <h2>‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß...</h2>
          <div class="your-queue"></div>
          <div class="others"></div>
          <button class="leave-btn" id="leaveQueueBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß</button>
        </div>
      </div>
      <div id="shop" class="shop-content content">
        <h1>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <div id="shopAdminAddFormWrapper" style="display:none;">
          <form class="shop-add-form" id="shopAddForm" autocomplete="off">
            <div class="shop-form-label">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
            <input type="text" id="shopImgUrlInput" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÉ‡∏™‡πà https://...)" maxlength="400" />
            <input type="text" id="shopTitleInput" maxlength="40" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required />
            <input type="number" id="shopPriceInput" min="0" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" required />
            <input type="number" id="shopStockInput" min="0" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á" required />
            <input type="hidden" id="shopEditKeyInput" value="" />
            <button type="submit" id="shopAddBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <div id="shopFormMsg" style="color:#ffb3b3;min-height:1em;"></div>
          </form>
        </div>
        <div class="shop-grid" id="shopGrid"></div>
      </div>
      <div id="contact" class="content">
        <h1>PK4</h1>
        <div class="contact-list" id="contactList">
          <p>üìß Roblox: <a href="https://www.roblox.com/users/849036274/profile" target="_blank" rel="noopener noreferrer">LingkinPug</a></p>
          <p>üí¨ Discord: <a href="https://discord.gg/RyVVMRs9rN" target="_blank" rel="noopener noreferrer">Lingkinpug community</a></p>
          <p>üåê Tiktok: <a href="https://www.tiktok.com/@lingkinpug8" target="_blank" rel="noopener noreferrer">@lingkinpug8</a></p>
          <p>üì± Facebook: <a href="https://web.facebook.com/110rr?locale=th_TH" target="_blank" rel="noopener noreferrer">Lingkinpug</a></p>
        </div>
      </div>
      <div id="admin" class="content">
        <h1>Admin Panel</h1>
        <form class="admin-login-form" id="adminLoginForm" autocomplete="off">
          <div class="admin-message" id="adminLoginMsg"></div>
          <label for="adminPass">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î</label>
          <input type="password" id="adminPass" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î" required />
          <button type="submit">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>
        <div class="admin-panel" id="adminPanel" style="display: none;">
          <div class="admin-message" id="adminMsg"></div>
          <div class="admin-toggle-queue">
            <input type="checkbox" id="toggleQueueOpen" />
            <label for="toggleQueueOpen" style="margin-bottom:0;">‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</label>
            <span id="toggleQueueStatus"></span>
          </div>
          <div>
            <label style="font-size:1.15em;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Leaderboard</label>
            <form id="addPlayerForm" style="display:flex; gap:8px;">
              <input type="text" id="addPlayerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠" maxlength="24" required />
              <input type="number" id="addPlayerScore" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" min="0" style="width:80px;" required />
              <button type="submit" style="margin:0;">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
            </form>
            <div class="players-list" id="adminPlayersList"></div>
          </div>
          <div>
            <label style="font-size:1.15em;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß</label>
            <div class="queue-list" id="adminQueueList" style="margin-top:0;">
              <div class="queue-list-title">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß</div>
              <div class="scrollable-queue-wrapper">
                <ol id="adminQueueListItems"></ol>
              </div>
            </div>
          </div>
          <button id="adminLogoutBtn" type="button">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>
    </div>
  </div>
<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCSAH5EAPC9stXeFPpG9L_FDlj-gta0OjU",
    authDomain: "lingkinpug-queue.firebaseapp.com",
    databaseURL: "https://lingkinpug-queue-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "lingkinpug-queue",
    storageBucket: "lingkinpug-queue.appspot.com",
    messagingSenderId: "962204289870",
    appId: "1:962204289870:web:b69d6b9ec030776b1b2c1f",
    measurementId: "G-DH6J2241S9"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // --- Open/Close Queue Toggle ---
  let queueOpen = true;
  const queueClosedMsg = document.getElementById("queueClosedMsg");
  const queueForm = document.getElementById("queueForm");
  const queueTab = document.querySelector('.tab[data-tab="queue"]');
  const toggleQueueOpen = document.getElementById("toggleQueueOpen");
  const toggleQueueStatus = document.getElementById("toggleQueueStatus");
  function setQueueFormState(open) {
    queueOpen = open;
    if (open) {
      queueClosedMsg.style.display = "none";
      if (!myName || !allQueue.some(q => q.name === myName)) {
        queueForm.style.display = "flex";
      }
    } else {
      queueClosedMsg.style.display = "block";
      queueForm.style.display = "none";
    }
    if (toggleQueueOpen) {
      toggleQueueOpen.checked = !!open;
      toggleQueueStatus.textContent = open ? "(‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß)" : "(‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß)";
      toggleQueueStatus.style.color = open ? "#47ff4b" : "#ff4b4b";
    }
  }
  const settingsRef = db.ref('settings/queueOpen');
  settingsRef.on('value', snap => {
    const open = snap.exists() ? snap.val() : true;
    setQueueFormState(open);
  });
  if (toggleQueueOpen) {
    toggleQueueOpen.addEventListener('change', function() {
      settingsRef.set(!!toggleQueueOpen.checked);
    });
  }

  // Snail Drop Effect
  function dropSnails(durationMs = 3000, interval = 180) {
    const emoji = "üêå";
    const container = document.getElementById("snailDropContainer");
    container.style.pointerEvents = "none";
    container.style.position = "fixed";
    container.style.left = "0";
    container.style.top = "0";
    container.style.width = "100vw";
    container.style.height = "100vh";
    container.style.zIndex = "1000";
    container.style.overflow = "hidden";
    let running = true;
    function randomLeft() { return Math.random() * 90 + 2; }
    function randomSize() { return Math.random() * 32 + 28; }
    function randomDuration() { return Math.random() * 1.4 + 1.6; }
    function createSnail() {
      if (!running) return;
      const snail = document.createElement("div");
      snail.textContent = emoji;
      const left = randomLeft();
      const size = randomSize();
      const fallDur = randomDuration();
      snail.style.position = "fixed";
      snail.style.left = left + "vw";
      snail.style.top = "-60px";
      snail.style.fontSize = size + "px";
      snail.style.userSelect = "none";
      snail.style.pointerEvents = "none";
      snail.style.opacity = "0.93";
      snail.style.transition = `transform ${fallDur}s linear, opacity 0.3s`;
      snail.style.transform = `translateY(0) rotate(${Math.random()*40-20}deg)`;
      container.appendChild(snail);
      setTimeout(() => {
        snail.style.transform = `translateY(${window.innerHeight + 80}px) rotate(${Math.random()*40-20}deg)`;
        snail.style.opacity = "0.75";
      }, 30);
      setTimeout(() => {
        snail.remove();
      }, fallDur * 1000 + 1000);
    }
    const intervalId = setInterval(createSnail, interval);
    setTimeout(() => {
      running = false;
      clearInterval(intervalId);
      setTimeout(() => { container.innerHTML = ""; }, 2000);
    }, durationMs);
  }
  window.addEventListener("DOMContentLoaded", function(){
    dropSnails(3000, 150);
    if (checkAdminRemembered()) {
      showAdminPanel();
    }
  });

  function makeCopyableNames(container) {
    container = container || document;
    container.querySelectorAll('.copyable-name').forEach(el => {
      el.onclick = function(e) {
        e.preventDefault();
        const name = el.getAttribute('data-copy') || el.textContent;
        if (navigator.clipboard) {
          navigator.clipboard.writeText(name.trim());
        } else {
          const input = document.createElement('input');
          input.value = name.trim();
          document.body.appendChild(input);
          input.select();
          document.execCommand('copy');
          document.body.removeChild(input);
        }
      };
    });
  }

  // --- Popup Confirm Utility ---
  function showPopupConfirm({title, message, confirmText, cancelText, onConfirm, onCancel}) {
    let container = document.getElementById('popupContainer');
    container.innerHTML = '';
    const overlay = document.createElement('div');
    overlay.className = "popup-overlay";
    overlay.tabIndex = -1;
    const box = document.createElement('div');
    box.className = "popup-box";
    if (title) {
      const h2 = document.createElement('h2');
      h2.textContent = title;
      box.appendChild(h2);
    }
    const msgDiv = document.createElement('div');
    msgDiv.className = "popup-msg";
    msgDiv.innerHTML = message;
    box.appendChild(msgDiv);
    const btns = document.createElement('div');
    btns.className = "popup-btns";
    const btnYes = document.createElement('button');
    btnYes.textContent = confirmText || "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô";
    btnYes.onclick = () => {
      overlay.remove();
      if (onConfirm) onConfirm();
    };
    const btnNo = document.createElement('button');
    btnNo.textContent = cancelText || "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
    btnNo.onclick = () => {
      overlay.remove();
      if (onCancel) onCancel();
    };
    btns.appendChild(btnYes);
    btns.appendChild(btnNo);
    box.appendChild(btns);
    overlay.appendChild(box);
    container.appendChild(overlay);
    overlay.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { btnNo.click(); }
    });
    overlay.focus();
    overlay.addEventListener('click', function(e){
      if (e.target === overlay) btnNo.click();
    });
  }

  function showPopupInfo({title, message, okText, onOk}) {
    let container = document.getElementById('popupContainer');
    container.innerHTML = '';
    const overlay = document.createElement('div');
    overlay.className = "popup-overlay";
    overlay.tabIndex = -1;
    const box = document.createElement('div');
    box.className = "popup-box";
    if (title) {
      const h2 = document.createElement('h2');
      h2.textContent = title;
      box.appendChild(h2);
    }
    const msgDiv = document.createElement('div');
    msgDiv.className = "popup-msg";
    msgDiv.innerHTML = message;
    box.appendChild(msgDiv);
    const btns = document.createElement('div');
    btns.className = "popup-btns";
    const btnOk = document.createElement('button');
    btnOk.textContent = okText || "‡∏ï‡∏Å‡∏•‡∏á";
    btnOk.onclick = () => {
      overlay.remove();
      if (onOk) onOk();
    };
    btns.appendChild(btnOk);
    box.appendChild(btns);
    overlay.appendChild(box);
    container.appendChild(overlay);
    overlay.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { btnOk.click(); }
    });
    overlay.focus();
    overlay.addEventListener('click', function(e){
      if (e.target === overlay) btnOk.click();
    });
  }

  // Utility to format remaining milliseconds as HH:MM:SS
  function formatTimeLeft(ms) {
    if (ms < 0) ms = 0;
    const s = Math.floor(ms/1000);
    const h = Math.floor(s/3600);
    const m = Math.floor((s%3600)/60);
    const sec = s%60;
    let parts = [];
    if (h > 0) parts.push(h + " ‡∏ä‡∏°.");
    if (m > 0 || h > 0) parts.push(m + " ‡∏ô‡∏≤‡∏ó‡∏µ");
    parts.push(sec + " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ");
    return parts.join(" ");
  }

  // Leaderboard Realtime
  let players = [];
  db.ref('leaderboard').on('value', snapshot => {
    const arr = [];
    snapshot.forEach(child => {
      arr.push({ key: child.key, ...child.val() });
    });
    arr.sort((a, b) => b.score - a.score);
    players = arr;
    renderLeaderboardTable();
    renderAdminPlayersList();
  });
  function getRank(score) {
    if (score >= 1500) return "S";
    if (score >= 1200) return "A";
    if (score >= 800) return "B";
    if (score >= 400) return "C";
    return "D";
  }
  function renderLeaderboardTable() {
    const tbody = document.getElementById("leaderboardBody");
    tbody.innerHTML = "";
    players.forEach((player, index) => {
      const rank = getRank(player.score);
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>#${index + 1}</td>
        <td><span class="copyable-name" data-copy="${player.name}">${player.name}</span></td>
        <td>${player.score}</td>
        <td><span class="rank-tier ${rank}">${rank}</span></td>
      `;
      tbody.appendChild(tr);
    });
    makeCopyableNames(tbody);
  }

  // Queue Realtime
  let allQueue = [];
  let myName = localStorage.getItem("lingkinpugMyQueueName") || "";
  let myQueueKey = localStorage.getItem("lingkinpugMyQueueKey") || "";
  db.ref('queue').on('value', snapshot => {
    const arr = [];
    snapshot.forEach(child => {
      arr.push({ key: child.key, ...child.val() });
    });
    arr.sort((a, b) => a.time - b.time);
    allQueue = arr;
    renderQueue(arr);
    renderAdminQueueList(arr);
    updateQueueTabScreen();
  });

  // -------------------- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏±‡∏ô‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥ 1 ‡∏ß‡∏±‡∏ô ‡∏î‡πâ‡∏ß‡∏¢ queue_history --------------------
  let queueHistoryLast24h = [];
  function updateQueueHistoryCache() {
    // ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô 24 ‡∏ä‡∏°. ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const since = Date.now() - 86400000;
    db.ref('queue_history').orderByChild('time').startAt(since).on('value', snapshot => {
      const arr = [];
      snapshot.forEach(child => {
        arr.push(child.val());
      });
      queueHistoryLast24h = arr;
    });
  }
  updateQueueHistoryCache();

  function isWithinOneDay(oldTime) {
    return (Date.now() - oldTime) < 86400000;
  }

  function addToQueue(name, note) {
    if (!queueOpen) {
      queueMessage.textContent = "‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß";
      return;
    }
    const nameLower = name.trim().toLowerCase();
    // Check in queue_history
    const existed = queueHistoryLast24h.find(q => q.name.trim().toLowerCase() === nameLower);
    if (existed) {
      // Show popup with time left
      const timeLeft = existed.time + 86400000 - Date.now();
      showPopupInfo({
        title: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ",
        message: `‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤<br><br>‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏≠‡∏µ‡∏Å <span style="color:#ff4b4b;font-weight:bold;">${formatTimeLeft(timeLeft)}</span> ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`,
        okText: "‡∏ï‡∏Å‡∏•‡∏á"
      });
      queueMessage.textContent = "‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤";
      return;
    }
    // Check in current queue (in case cache not up-to-date)
    const found = allQueue.find(q => q.name.trim().toLowerCase() === nameLower);
    if (found && isWithinOneDay(found.time)) {
      // Find latest time (whichever is later)
      const latestTime = Math.max(found.time, existed ? existed.time : 0);
      const timeLeft = latestTime + 86400000 - Date.now();
      showPopupInfo({
        title: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ",
        message: `‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤<br><br>‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏≠‡∏µ‡∏Å <span style="color:#ff4b4b;font-weight:bold;">${formatTimeLeft(timeLeft)}</span> ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`,
        okText: "‡∏ï‡∏Å‡∏•‡∏á"
      });
      queueMessage.textContent = "‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤";
      return;
    }
    // Normal: Add to queue and history
    const ref = db.ref('queue').push();
    const now = Date.now();
    ref.set({ name, note, time: now }).then(() => {
      db.ref('queue_history').push({ name, note, time: now });
      localStorage.setItem("lingkinpugMyQueueName", name);
      localStorage.setItem("lingkinpugMyQueueKey", ref.key);
      myName = name;
      myQueueKey = ref.key;
      const queueArr = [...allQueue, { key: ref.key, name, note, time: now }];
      showWaitingScreen(queueArr);
    });
  }
  function removeFromQueueByName(name) {
    const found = allQueue.find(q => q.name === name);
    if (found) db.ref('queue/' + found.key).remove();
    if (myName === name) {
      myName = "";
      myQueueKey = "";
      localStorage.removeItem("lingkinpugMyQueueName");
      localStorage.removeItem("lingkinpugMyQueueKey");
    }
  }
  function removeFromQueueByKey(key) {
    db.ref('queue/' + key).remove();
    if (myQueueKey === key) {
      myName = "";
      myQueueKey = "";
      localStorage.removeItem("lingkinpugMyQueueName");
      localStorage.removeItem("lingkinpugMyQueueKey");
    }
  }
  // Queue UI
  const queueName = document.getElementById("queueName");
  const queueNote = document.getElementById("queueNote");
  const queueMessage = document.getElementById("queueMessage");
  const queueListItems = document.getElementById("queueListItems");
  const queueWaiting = document.getElementById("queueWaiting");
  const leaveQueueBtn = document.getElementById("leaveQueueBtn");
  const queueList = document.getElementById("queueList");

  function renderQueue(queueArr) {
    queueListItems.innerHTML = "";
    if (!queueArr || queueArr.length === 0) {
      queueListItems.innerHTML = "<li style='color:#d1a3a3;font-style:italic;'>- ‡∏Ñ‡∏¥‡∏ß‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á -</li>";
      return;
    }
    queueArr.forEach((item, idx) => {
      queueListItems.innerHTML += `<li><span class="copyable-name" data-copy="${item.name}">${item.name}</span>${item.note ? ` <span style="color:#d1a3a3;">(${item.note})</span>` : ""}</li>`;
    });
    makeCopyableNames(queueListItems);
  }
  function showWaitingScreen(queueArr) {
    queueForm.style.display = "none";
    queueList.style.display = "none";
    queueWaiting.style.display = "block";
    const idx = queueArr.findIndex(q => q.name === myName);
    if (idx === -1) { showFormScreen(); return; }
    queueWaiting.querySelector('.your-queue').innerHTML =
      `‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏≥‡∏î‡∏±‡∏ö <span style="color:#ff4b4b;font-size:1.2em;">#${idx+1}</span> ‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß<br>
       <span class="copyable-name" data-copy="${queueArr[idx].name}">${queueArr[idx].name}</span>
       <span style="color:#d1a3a3;font-size:0.9em;">${queueArr[idx].note ? `(${queueArr[idx].note})` : ''}</span>`;
    let others = "";
    if (idx > 0) {
      others += `‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤:<br>`;
      for(let i=Math.max(0,idx-2);i<idx;i++) {
        others += `<span class="copyable-name" data-copy="${queueArr[i].name}" style="color:#ffb3b3;">#${i+1} ${queueArr[i].name}</span>${queueArr[i].note ? ` <span style="color:#d1a3a3">(${queueArr[i].note})</span>` : ""}<br>`;
      }
    }
    queueWaiting.querySelector('.others').innerHTML = others;
    makeCopyableNames(queueWaiting);
  }
  function showFormScreen() {
    queueForm.reset();
    queueMessage.textContent = "";
    queueWaiting.style.display = "none";
    queueForm.style.display = "flex";
    queueList.style.display = "block";
    myName = "";
    myQueueKey = "";
    localStorage.removeItem("lingkinpugMyQueueName");
    localStorage.removeItem("lingkinpugMyQueueKey");
  }
  function updateQueueTabScreen() {
    if (!queueOpen) {
      setQueueFormState(false);
      if (myName && allQueue.some(q => q.name === myName)) {
        showWaitingScreen(allQueue);
      }
      return;
    }
    if (myName && allQueue.some(q => q.name === myName)) {
      showWaitingScreen(allQueue);
    } else {
      showFormScreen();
    }
  }
  queueForm.addEventListener("submit", function(e) {
    e.preventDefault();
    const name = queueName.value.trim();
    const note = queueNote.value.trim();
    if (!name) {
      queueMessage.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
      return;
    }
    if (allQueue.length >= 50) {
      queueMessage.textContent = "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß";
      return;
    }
    addToQueue(name, note);
  });

  leaveQueueBtn.addEventListener("click", function() {
    showPopupConfirm({
      title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß",
      message: `‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß <span style="color:#ffb3b3;font-weight:bold;">‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span><br><br>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß?`,
      confirmText: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏ß",
      cancelText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
      onConfirm: function() {
        removeFromQueueByName(myName);
        showFormScreen();
        renderQueue(allQueue);
      }
    });
  });

  queueTab.addEventListener("click", updateQueueTabScreen);

  // Admin
  const ADMIN_PASSWORD = "pugking2024";
  const ADMIN_STORAGE_KEY = "lingkinpugAdminLogin";
  const adminTab = document.querySelector('.tab[data-tab="admin"]');
  const adminLoginForm = document.getElementById("adminLoginForm");
  const adminLoginMsg = document.getElementById("adminLoginMsg");
  const adminPanel = document.getElementById("adminPanel");
  const adminMsgDiv = document.getElementById("adminMsg");
  const addPlayerForm = document.getElementById("addPlayerForm");
  const addPlayerName = document.getElementById("addPlayerName");
  const addPlayerScore = document.getElementById("addPlayerScore");
  const adminQueueListItems = document.getElementById("adminQueueListItems");
  const adminLogoutBtn = document.getElementById("adminLogoutBtn");
  let isAdmin = false;

  // Check admin login on load
  function checkAdminRemembered() {
    return localStorage.getItem(ADMIN_STORAGE_KEY) === "1";
  }
  function rememberAdminLogin() {
    localStorage.setItem(ADMIN_STORAGE_KEY, "1");
  }
  function forgetAdminLogin() {
    localStorage.removeItem(ADMIN_STORAGE_KEY);
  }

  function adminMsg(msg, type) {
    adminMsgDiv.textContent = msg;
    adminMsgDiv.style.color = type === "ok" ? "#ffb3b3" : "#ff4b4b";
    setTimeout(() => adminMsgDiv.textContent = "", 2000);
  }
  function addPlayer(name, score) {
    db.ref('leaderboard').push({ name, score });
  }
  function updatePlayer(key, name, score) {
    db.ref('leaderboard/' + key).update({ name, score });
  }
  function removePlayer(key) {
    db.ref('leaderboard/' + key).remove();
  }
  function renderAdminPlayersList() {
    const listDiv = document.getElementById("adminPlayersList");
    let html = `<table><thead>
      <tr><th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th><th>‡∏•‡∏ö</th></tr>
      </thead><tbody>`;
    players.forEach((player, index) => {
      html += `<tr>
        <td>#${index + 1}</td>
        <td><input data-index="${index}" data-field="name" value="${player.name}" maxlength="24" style="width:85px;background:#550000;color:#ffc9c9;text-align:center;border-radius:12px;border:1px solid #772222;" /></td>
        <td><input data-index="${index}" data-field="score" type="number" value="${player.score}" min="0" style="width:65px;background:#550000;color:#ffc9c9;text-align:center;border-radius:12px;border:1px solid #772222;" /></td>
        <td><button data-index="${index}" class="admin-save-player">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></td>
        <td><button data-index="${index}" class="admin-remove-player">‡∏•‡∏ö</button></td>
      </tr>`;
    });
    html += "</tbody></table>";
    listDiv.innerHTML = html;
    listDiv.querySelectorAll(".admin-save-player").forEach(btn => {
      btn.onclick = function(){
        const idx = parseInt(btn.getAttribute("data-index"));
        const nameInput = listDiv.querySelector(`input[data-index="${idx}"][data-field="name"]`);
        const scoreInput = listDiv.querySelector(`input[data-index="${idx}"][data-field="score"]`);
        let player = players[idx];
        updatePlayer(player.key, nameInput.value.trim().substring(0,24), parseInt(scoreInput.value)||0);
        adminMsg("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","ok");
      };
    });
    listDiv.querySelectorAll(".admin-remove-player").forEach(btn => {
      btn.onclick = function(){
        if (!confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
        const idx = parseInt(btn.getAttribute("data-index"));
        let player = players[idx];
        removePlayer(player.key);
        adminMsg("‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","ok");
      };
    });
  }
  function renderAdminQueueList(queueArr) {
    if (!queueArr) return;
    adminQueueListItems.innerHTML = "";
    if (queueArr.length === 0) {
      adminQueueListItems.innerHTML = "<li style='color:#d1a3a3;font-style:italic;'>- ‡∏Ñ‡∏¥‡∏ß‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á -</li>";
      return;
    }
    queueArr.forEach((item, idx) => {
      adminQueueListItems.innerHTML += `<li>
        <span><span class="copyable-name" data-copy="${item.name}">${item.name}</span>${item.note ? ` <span style="color:#d1a3a3;">(${item.note})</span>` : ""}</span>
        <span class="admin-queue-btns">
          <button data-key="${item.key}" class="admin-remove-queue">‡∏•‡∏ö</button>
        </span>
      </li>`;
    });
    makeCopyableNames(adminQueueListItems);
    adminQueueListItems.querySelectorAll(".admin-remove-queue").forEach(btn => {
      btn.onclick = function() {
        if (!confirm("‡∏•‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
        const key = btn.getAttribute("data-key");
        removeFromQueueByKey(key);
      };
    });
  }
  function showAdminPanel() {
    isAdmin = true;
    adminLoginForm.style.display = "none";
    adminPanel.style.display = "flex";
    renderAdminPlayersList();
    renderAdminQueueList(allQueue);
    updateShopAdminFormState();
    settingsRef.once('value').then(snap=>{
      toggleQueueOpen.checked = snap.exists() ? !!snap.val() : true;
      toggleQueueStatus.textContent = toggleQueueOpen.checked ? "(‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß)" : "(‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß)";
      toggleQueueStatus.style.color = toggleQueueOpen.checked ? "#47ff4b" : "#ff4b4b";
    });
  }
  function showAdminLogin() {
    isAdmin = false;
    adminLoginForm.style.display = "flex";
    adminPanel.style.display = "none";
    updateShopAdminFormState();
    adminLoginForm.reset();
    adminLoginMsg.textContent = "";
  }
  adminLoginForm.addEventListener("submit", function(e){
    e.preventDefault();
    const pass = document.getElementById("adminPass").value;
    if(pass === ADMIN_PASSWORD){
      rememberAdminLogin();
      showAdminPanel();
    }else{
      adminLoginMsg.textContent = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î";
      adminLoginMsg.style.color = "#ff4b4b";
    }
  });
  adminLogoutBtn.addEventListener("click", function(){
    forgetAdminLogin();
    showAdminLogin();
  });

  // SHOP SYSTEM (URL only, no Firebase Storage)
  let shopProducts = [];
  const shopGrid = document.getElementById("shopGrid");
  const shopTab = document.querySelector('.tab[data-tab="shop"]');
  const shopContent = document.getElementById("shop");
  const shopAdminAddFormWrapper = document.getElementById("shopAdminAddFormWrapper");
  const shopAddForm = document.getElementById("shopAddForm");
  const shopImgUrlInput = document.getElementById("shopImgUrlInput");
  const shopTitleInput = document.getElementById("shopTitleInput");
  const shopPriceInput = document.getElementById("shopPriceInput");
  const shopStockInput = document.getElementById("shopStockInput");
  const shopEditKeyInput = document.getElementById("shopEditKeyInput");
  const shopFormMsg = document.getElementById("shopFormMsg");

  function loadShopProducts() {
    db.ref('shop').on('value', snap => {
      const arr = [];
      snap.forEach(child => {
        // Ensure null/undefined are filtered out
        const val = child.val();
        if (val) arr.push({ key: child.key, ...val });
      });
      shopProducts = arr;
      renderShopGrid();
    });
  }
  loadShopProducts();

  function renderShopGrid() {
    shopGrid.innerHTML = "";
    if (!shopProducts || shopProducts.length === 0) {
      shopGrid.innerHTML = `<div style="color:#d1a3a3;font-style:italic;">- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô -</div>`;
      return;
    }
    // FIX: Use document fragment to prevent only showing the last one
    const frag = document.createDocumentFragment();
    shopProducts.forEach(prod => {
      const card = document.createElement("div");
      card.className = "shop-card";
      card.innerHTML = `
        <img class="shop-img" src="${prod.imgUrl ? prod.imgUrl : 'https://cdn-icons-png.flaticon.com/512/1170/1170678.png'}" alt="shop-img" />
        <div class="shop-title">${prod.title}</div>
        <div class="shop-price">‡∏£‡∏≤‡∏Ñ‡∏≤: <span style="color:#47ff4b">${prod.price}</span></div>
        <div class="shop-stock">‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ: <span style="color:#ffb3b3">${prod.stock}</span></div>
      `;
      if (isAdmin || checkAdminRemembered()) {
        card.innerHTML += `
          <div class="shop-admin-actions">
            <button data-key="${prod.key}" class="shop-edit-btn">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button data-key="${prod.key}" class="shop-delete-btn">‡∏•‡∏ö</button>
          </div>
        `;
      }
      frag.appendChild(card);
    });
    shopGrid.appendChild(frag);
    // Add event listeners for edit/delete to all buttons
    if (isAdmin || checkAdminRemembered()) {
      shopGrid.querySelectorAll('.shop-edit-btn').forEach(btn => {
        btn.onclick = function() {
          const key = btn.getAttribute('data-key');
          const prod = shopProducts.find(p=>p.key===key);
          if (!prod) return;
          shopEditKeyInput.value = prod.key;
          shopImgUrlInput.value = prod.imgUrl || "";
          shopTitleInput.value = prod.title;
          shopPriceInput.value = prod.price;
          shopStockInput.value = prod.stock;
          shopFormMsg.textContent = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: "+prod.title;
          shopAdminAddFormWrapper.scrollIntoView({behavior:"smooth"});
        }
      });
      shopGrid.querySelectorAll('.shop-delete-btn').forEach(btn => {
        btn.onclick = function() {
          const key = btn.getAttribute('data-key');
          const prod = shopProducts.find(p=>p.key===key);
          if (!prod) return;
          showPopupConfirm({
            title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
            message: `‡∏•‡∏ö <strong>${prod.title}</strong> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô?`,
            confirmText: "‡∏•‡∏ö",
            cancelText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
            onConfirm: function() {
              db.ref('shop/'+key).remove();
              shopFormMsg.textContent = "";
            }
          });
        }
      });
    }
  }

  function resetShopForm() {
    shopImgUrlInput.value = "";
    shopTitleInput.value = "";
    shopPriceInput.value = "";
    shopStockInput.value = "";
    shopEditKeyInput.value = "";
    shopFormMsg.textContent = "";
  }

  // Add/Edit product
  shopAddForm.addEventListener("submit", function(e) {
    e.preventDefault();
    shopFormMsg.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
    const title = shopTitleInput.value.trim();
    const price = parseInt(shopPriceInput.value);
    const stock = parseInt(shopStockInput.value);
    const imgUrl = shopImgUrlInput.value.trim();
    const editKey = shopEditKeyInput.value;

    function saveProduct() {
      const prodData = { title, price, stock, imgUrl: imgUrl || "" };
      if (editKey) {
        db.ref('shop/'+editKey).update(prodData).then(()=>{
          shopFormMsg.textContent = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
          resetShopForm();
        });
      } else {
        db.ref('shop').push(prodData).then(()=>{
          shopFormMsg.textContent = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!";
          resetShopForm();
        });
      }
    }
    saveProduct();
  });

  // Show/Hide admin product form
  function updateShopAdminFormState() {
    if (isAdmin || checkAdminRemembered()) {
      shopAdminAddFormWrapper.style.display = "block";
    } else {
      shopAdminAddFormWrapper.style.display = "none";
    }
    resetShopForm();
  }

  // Tab logic (add shop tab)
  const tabs = document.querySelectorAll(".tab");
  const contents = document.querySelectorAll(".content");
  const clickSound = new Audio("https://freesound.org/data/previews/256/256113_3263906-lq.mp3");
  clickSound.volume = 0.15;
  const typingSound = new Audio("https://freesound.org/data/previews/221/221663_4019027-lq.mp3");
  typingSound.volume = 0.07;
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      clickSound.currentTime = 0;
      clickSound.play();
      tabs.forEach(t => t.classList.remove("active"));
      contents.forEach(c => c.classList.remove("active"));
      tab.classList.add("active");
      const target = tab.dataset.tab;
      document.getElementById(target).classList.add("active");
      if (target === "queue") updateQueueTabScreen();
      if (target === "leaderboard") renderLeaderboardTable();
      if (target === "admin") {
        if(isAdmin || checkAdminRemembered()) showAdminPanel(); else showAdminLogin();
      }
      if (target === "shop") {
        updateShopAdminFormState();
        renderShopGrid();
      }
    });
  });

  // Ensure admin panel triggers shop form on login/logout (already handled above)

  // Shop: If entering via URL hash or default, show correct tab
  if (location.hash === "#shop") {
    shopTab.click();
  }

  document.getElementById("searchInput").addEventListener("keydown", () => {
    if (typingSound.paused) {
      typingSound.currentTime = 0;
      typingSound.play();
    }
  });
  queueName.addEventListener("keydown", () => {
    if (typingSound.paused) {
      typingSound.currentTime = 0;
      typingSound.play();
    }
  });
  queueNote.addEventListener("keydown", () => {
    if (typingSound.paused) {
      typingSound.currentTime = 0;
      typingSound.play();
    }
  });
  document.getElementById("searchInput").addEventListener("input", () => {
    const query = document.getElementById("searchInput").value.trim().toLowerCase();
    const info = document.getElementById("rankInfo");
    const foundIndex = players.findIndex(p => p.name.toLowerCase() === query);
    if (foundIndex !== -1) {
      const player = players[foundIndex];
      info.innerHTML = `<strong>${player.name}</strong> ‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö <strong>#${foundIndex + 1}</strong> ‡πÅ‡∏£‡∏á‡∏Ñ‡πå: <span class="rank-tier ${getRank(player.score)}">${getRank(player.score)}</span> (${player.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)`;
    } else {
      info.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á";
    }
  });

  // Tilt effect (Disabled, just keep UI static so buttons match mouse)
  // const container = document.getElementById("tiltContainer");
  // let mouseX = 0, mouseY = 0, rotateX = 0, rotateY = 0;
  // window.addEventListener("mousemove", e => {
  //   const rect = container.getBoundingClientRect();
  //   mouseX = e.clientX - (rect.left + rect.width / 2);
  //   mouseY = e.clientY - (rect.top + rect.height / 2);
  // });
  // function animate() {
  //   rotateX += (mouseY / 25 - rotateX) * 0.1;
  //   rotateY += (mouseX / 25 - rotateY) * 0.1;
  //   container.style.transform = `rotateX(${-rotateX}deg) rotateY(${rotateY}deg)`;
  //   requestAnimationFrame(animate);
  // }
  // animate();

  // BG particles
  const bg = document.getElementById("backgroundEffect");
  function randomBetween(min, max) {
    return Math.random() * (max - min) + min;
  }
  for (let i = 0; i < 30; i++) {
    const p = document.createElement("div");
    p.classList.add("particle");
    const sizeClass = i % 3 === 0 ? "small" : (i % 3 === 1 ? "medium" : "large");
    p.classList.add(sizeClass);
    p.style.top = `${randomBetween(0, 100)}%`;
    p.style.left = `${randomBetween(0, 100)}%`;
    p.style.animationDelay = `${randomBetween(0, 20)}s`;
    bg.appendChild(p);
  }
  makeCopyableNames(document.getElementById('contactList'));
  renderLeaderboardTable();
</script>
<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° div ‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scroll ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å) -->
<div style="height: 120px;"></div>
</body>
</html>
